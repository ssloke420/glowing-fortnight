<!DOCTYPE html>
<html ng-app="glow">
<head>
    <title>Glowing Fortnight</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
    <style>
        body {
            color: darkorange;
            font-family: monospace;
            text-decoration: double;
            text-align: center;
            background-image: linear-gradient(brown, maroon, red);
        }
    </style>
</head>
<body ng-controller="GlowingController">
<h1 style="font-size: 50pt;">Glowing Fortnight</h1>
<h1>Current time: {{datetime.time}}</h1>
<h1>Current date: {{datetime.date}}</h1>
<h1 id="user"></h1>
<input id="usernameInput" placeholder="Enter your username."/>
<input id="city" placeholder="Enter your city."/>
<div weather-info></div>
<script>
    let app = angular.module('glow', []);
    app.controller('GlowingController', function($scope, $interval) {
        $scope.datetime = {time: "", date: ""}
        $scope.datetime.time = new Date().toLocaleTimeString();
        $scope.datetime.date = new Date().toLocaleDateString();
        let updateTime = function () {
            $scope.datetime.time = new Date().toLocaleTimeString();
            $scope.datetime.date = new Date().toLocaleDateString();
        }
        updateTime();
        $interval(updateTime, 1000);
    });

    let username;
    let userInput = document.getElementById("usernameInput");
    userInput.addEventListener("keydown", function(e){
        if (e.key == "Enter") {
            let inputUsername = userInput.value.trim();
            if (inputUsername !== "") {
                let confirmation = confirm("Are you sure you would like to save this username?");
                if (confirmation) {
                    document.cookie = `username=${inputUsername}; expires=Thu, 18 Dec 2024 12:00:00 UTC; path=/;`;
                    username = inputUsername;
                    document.getElementById("user").innerHTML = "User: " + username;
                    userInput.style.display = "none";
                }
            } else {
                alert("Please enter a username.");
            }
        }
    });

    function checkCookies() {
        let cookies = document.cookie.split(';');
        let usernameExists = false;
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith("username=")) {
                usernameExists = true;
                username = cookie.substring("username=".length);
                document.getElementById("user").innerHTML = "User: " + username;
                userInput.style.display = "none";
                break;
            }
        }
    }

    // Call checkCookies after the DOM has been fully loaded
    window.addEventListener("load", checkCookies);

    // Function to fetch weather data from OpenWeatherMap API
    function fetchWeather(city) {
        const apiKey = 'dd41067365b545f2a3cad7d24992b617';
        const apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;

        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Parse and display weather data
                const temperature = data.main.temp;
                const description = data.weather[0].description;
                const humidity = data.main.humidity;
                const windSpeed = data.wind.speed;
                const cityName = data.name;

                // Display weather data on the webpage
                document.getElementById('weather-info').innerHTML = `
                    <h2>Weather in ${cityName}</h2>
                    <p>Temperature: ${temperature}Â°C</p>
                    <p>Description: ${description}</p>
                    <p>Humidity: ${humidity}%</p>
                    <p>Wind Speed: ${windSpeed} m/s</p>
                `;
            })
            .catch(error => {
                console.error('Error fetching weather data:', error);
                document.getElementById('weather-info').innerHTML = '<p>Error fetching weather data. Please try again later.</p>';
            });
    }

    // Example usage: Fetch weather data for a specific city
    let cityInput = document.getElementById("city");
    cityInput.addEventListener('keydown', function(e) {
        if (e.key == "Enter") {
            fetchWeather(cityInput.value);
            cityInput.style.display = "none";
        }
    });
</script>
</body>
</html>
